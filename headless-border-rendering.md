# Headless Frontend Border Rendering Guide

## Overview

The headless frontend (public-facing store pages) uses CSS custom properties (CSS variables) generated by `lib/css-generator.ts` to render borders dynamically. This document explains how borders should be rendered and the rules that govern their display.

## Border Rendering Rules

### 1. Required Properties for Border Display

For a border to be **visible**, all three of these CSS properties must be present:

1. **Border Width** - The thickness of the border (e.g., `2px`, `1px`)
2. **Border Style** - How the border appears (e.g., `solid`, `dashed`, `dotted`)
3. **Border Color** - The color of the border (e.g., `#e5e7eb`, `#000000`)

**If any of these three properties is missing, the border will NOT render.**

### 2. Linked vs Individual Border Modes

#### Linked Mode (All Sides Same)

When borders are "linked" (all four sides have the same width), the CSS uses shorthand properties:

```css
.block-example {
  --border-width: 2px;
  border-width: var(--border-width) !important;

  --border-style: solid;
  border-style: var(--border-style) !important;

  --border-color: #e5e7eb;
  border-color: var(--border-color) !important;

  /* Shorthand combining all three */
  border: var(--border-width) var(--border-style) var(--border-color) !important;
}
```

#### Individual Mode (Different Sides)

When borders have different widths per side, each side gets its own properties:

```css
.block-example {
  /* Top border */
  --border-top-width: 0px;
  border-top-width: var(--border-top-width);

  /* Right border */
  --border-right-width: 0px;
  border-right-width: var(--border-right-width);

  /* Bottom border */
  --border-bottom-width: 0px;
  border-bottom-width: var(--border-bottom-width);

  /* Left border - ONLY this side should be visible */
  --border-left-width: 2px;
  border-left-width: var(--border-left-width);
  --border-left-style: solid;
  border-left-style: var(--border-left-style) !important;
  --border-left-color: #e5e7eb;
  border-left-color: var(--border-left-color) !important;

  /* Main border color (shared) */
  --border-color: #e5e7eb;
  border-color: var(--border-color) !important;
}
```

### 3. Zero-Width Border Handling

**Critical Rule:** When a border width is set to `0` or `0px`, the following must happen:

1. **Remove** the width property
2. **Remove** the style property
3. **Remove** the color property

This prevents "ghost borders" from appearing.

**Example of CORRECT zero-width handling:**

```css
/* ❌ WRONG - Will show a border */
.block-wrong {
  --border-left-width: 0px;
  border-left-width: var(--border-left-width);
  --border-left-style: solid; /* This should NOT be here! */
  border-left-style: var(--border-left-style) !important;
}

/* ✅ CORRECT - No border properties at all */
.block-correct {
  /* No border-left properties = no border */
}
```

### 4. Default Border Style

When a border width is set but no style is specified, the default style must be **`solid`**.

**Example:**

```css
/* User sets width but no style */
.block-example {
  --border-width: 2px;
  border-width: var(--border-width) !important;

  /* System automatically adds solid style */
  --border-style: solid;
  border-style: var(--border-style) !important;
}
```

### 5. Border Color Inheritance

When individual border sides are used, they should inherit color from the main `--border-color` if no specific side color is set:

```css
.block-example {
  /* Main border color */
  --border-color: #e5e7eb;
  border-color: var(--border-color) !important;

  /* Left border inherits from main color */
  --border-left-width: 2px;
  border-left-width: var(--border-left-width);
  --border-left-style: solid;
  border-left-style: var(--border-left-style) !important;
  --border-left-color: #e5e7eb; /* Inherited from --border-color */
  border-left-color: var(--border-left-color) !important;
}
```

## Implementation in `lib/css-generator.ts`

### Code Location

Border rendering logic is implemented in [lib/css-generator.ts:277-421](lib/css-generator.ts#L277-L421).

### Key Functions

#### 1. Linked Mode Handler (Lines 299-358)

```typescript
if (hasBorderConfig) {
  if (!hasIndividualBorderWidths) {
    // Check if width is 0
    const borderWidth = baseProperties['--border-width'] || effectiveBlock.styles?.borderWidth
    if (borderWidth === '0' || borderWidth === '0px') {
      // Remove ALL border properties
      delete baseProperties['--border-width']
      delete baseProperties['border-width']
      delete baseProperties['--border-style']
      delete baseProperties['border-style']
      delete baseProperties['--border-color']
      delete baseProperties['border-color']
      delete baseProperties['border']
    } else {
      // Set default style to 'solid'
      if (!baseProperties['--border-style']) {
        baseProperties['--border-style'] = 'solid'
        baseProperties['border-style'] = 'var(--border-style) !important'
      }
    }
  }
}
```

#### 2. Individual Mode Handler (Lines 383-419)

```typescript
const sides = ['Top', 'Right', 'Bottom', 'Left']
sides.forEach(side => {
  const widthValue = baseProperties[widthCustomProp] || effectiveBlock.styles?.[widthKey]

  // Check for non-zero width
  if (widthValue && widthValue !== '0' && widthValue !== '0px') {
    // Add width if not already present
    if (!baseProperties[widthCustomProp]) {
      baseProperties[widthCustomProp] = widthValue
      baseProperties[widthCssProp] = `var(${widthCustomProp})`
    }

    // Add style (default to 'solid')
    if (!baseProperties[styleCustomProp]) {
      baseProperties[styleCustomProp] = 'solid'
      baseProperties[styleCssProp] = `var(${styleCustomProp}) !important`
    }

    // Inherit color from main border color
    if (baseProperties['--border-color'] && !baseProperties[colorCustomProp]) {
      baseProperties[colorCustomProp] = baseProperties['--border-color']
      baseProperties[colorCssProp] = `var(${colorCustomProp}) !important`
    }
  } else if (widthValue === '0' || widthValue === '0px') {
    // Remove all border properties for this side
    delete baseProperties[styleCustomProp]
    delete baseProperties[styleCssProp]
    delete baseProperties[colorCustomProp]
    delete baseProperties[colorCssProp]
    delete baseProperties[widthCustomProp]
    delete baseProperties[widthCssProp]
  }
})
```

## Visual Page Builder vs Headless Frontend

### Page Builder (Admin Interface)

- Uses inline styles via [components/page-builder-blocks.tsx](components/page-builder-blocks.tsx)
- `getBlockStyles()` function generates React `style` objects
- Border logic in lines 403-457

**Example inline style:**

```tsx
<div style={{
  borderLeftWidth: '2px',
  borderLeftStyle: 'solid',
  borderLeftColor: '#e5e7eb'
}}>
```

### Headless Frontend (Public Pages)

- Uses CSS custom properties via [lib/css-generator.ts](lib/css-generator.ts)
- `generateBlockCSS()` function generates CSS strings
- Border logic in lines 277-421

**Example CSS output:**

```css
.block-123 {
  --border-left-width: 2px;
  border-left-width: var(--border-left-width);
  --border-left-style: solid;
  border-left-style: var(--border-left-style) !important;
  --border-left-color: #e5e7eb;
  border-left-color: var(--border-left-color) !important;
}
```

## Common Issues and Fixes

### Issue 1: Borders Not Showing

**Symptom:** Border width and color are set, but border doesn't appear.

**Cause:** Missing `border-style` property.

**Fix:** Ensure `border-style: solid` (or other style) is always added when width > 0.

### Issue 2: Ghost Borders at 0px

**Symptom:** Border appears even when width is set to `0px`.

**Cause:** Style and color properties remain even though width is 0.

**Fix:** When width is `0` or `0px`, delete ALL border properties for that side.

### Issue 3: Individual Borders Missing Color

**Symptom:** Border shows but uses wrong color (often black).

**Cause:** Individual side color not inheriting from main `--border-color`.

**Fix:** When setting individual border styles, copy `--border-color` to `--border-{side}-color`.

## Testing Border Rendering

### Test Cases

1. **Linked mode with all sides 2px solid black**
   - Should show borders on all four sides

2. **Linked mode with width = 0px**
   - Should show NO borders

3. **Individual mode with only left border 2px**
   - Should show ONLY left border
   - Top, right, bottom should have NO borders

4. **Individual mode with left = 2px, others = 0px**
   - Should show ONLY left border
   - No ghost borders on other sides

5. **Border without explicit color**
   - Should inherit color from main `--border-color`
   - If no color at all, should use `currentColor` (text color)

### Verification

Check the generated HTML in browser DevTools:

```html
<div class="block-abc" style="...">
  <style>
    .block-abc {
      --border-left-width: 2px;
      border-left-width: var(--border-left-width);
      --border-left-style: solid;  /* ← Must be present! */
      border-left-style: var(--border-left-style) !important;
      --border-left-color: #e5e7eb;  /* ← Must be present! */
      border-left-color: var(--border-left-color) !important;
    }
  </style>
</div>
```

## Related Files

- [lib/css-generator.ts](lib/css-generator.ts) - CSS custom property generation for headless frontend
- [components/page-builder-blocks.tsx](components/page-builder-blocks.tsx) - Inline style generation for page builder
- [components/block-configuration-panel.tsx](components/block-configuration-panel.tsx) - Border configuration UI
- [components/responsive/responsive-spacing-controls.tsx](components/responsive/responsive-spacing-controls.tsx) - Border width controls with linked/unlinked toggle

## Responsive Border Behavior

Borders support responsive breakpoints (desktop, tablet, mobile). Each breakpoint can have different:

- Border widths (linked or individual)
- Border colors
- Border styles

**Example responsive CSS:**

```css
/* Desktop (default) */
.block-abc {
  --border-left-width: 2px;
  border-left-width: var(--border-left-width);
  --border-left-style: solid;
  border-left-style: var(--border-left-style) !important;
}

/* Mobile override */
@media (max-width: 767px) {
  .block-abc {
    --border-left-width: 0px !important;
    /* Style and color removed for 0px width */
  }
}
```

## Summary Checklist

When rendering borders on the headless frontend:

- ✅ Always include `border-style` when width > 0
- ✅ Default to `solid` style if not specified
- ✅ Include `border-color` or inherit from main color
- ✅ Remove ALL border properties when width = 0 or 0px
- ✅ Handle linked and individual modes correctly
- ✅ Support responsive breakpoints
- ✅ Use `!important` flag for proper specificity

**Remember:** A border needs **width + style + color** to be visible!
